<head>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>
<style>
  .icon-container {
    display: flex;
    align-items: flex-start;
    gap: 2rem;
  }

  .icon-box {
    flex: 1;
    text-align: center;
    position: relative;
    overflow: hidden;
    width: 250px;
    height: 250px;
    transition: all 0.3s ease; /* Smooth resizing */
  }

  .icon-box figure {
    display: inline-block;
    width: 100%;
    height: 100%;
  }

  .properties-box {
    flex: 1;
  }

  /* Responsive layout and larger SVG for zoom or smaller screens */
  @media (max-width: 800px) {
    .icon-container {
      flex-direction: column;
      align-items: center;
    }

    .icon-box {
      width: 550px;
      height: 550px;
    }

    .properties-box {
      width: 100%;
      text-align: left;
    }
  }
</style>

{% for icon in icons %}
<div style="display: flex; align-items: center; justify-content: space-between;">
  <h2 style="margin: 0;"> {{ icon.name }} </h2>
  <div style="display: flex;">
    <!-- Feedback Button -->
    <button onclick="openFeedbackDialog('feedbackDialog-{{ icon.name }}')"
      style="padding: 0.5rem; border: none; cursor: pointer; border-radius: 5px; display: flex; align-items: center; color:gray">
      <i class="fas fa-comment"></i>
    </button>
    <!-- Download Button -->
    <button
      onclick="downloadSvg('{{ icon.name }}', this)"
      style="padding: 0.5rem; border: none; cursor: pointer; border-radius: 5px; display: flex; align-items: center; color:gray">
      <i class="fas fa-download"></i>
    </button>
    <!-- Copy Button -->
    <button
      onclick="copySvgToClipboard('{{ icon.name }}')"
      style="padding: 0.5rem; border: none; cursor: pointer; border-radius: 5px; display: flex; align-items: center; color:gray">
      <i class="fas fa-copy"></i>
    </button>
  </div>
</div>

<dialog id="feedbackDialog-{{ icon.name }}">
  <form method="dialog" id="feedbackForm-{{ icon.name }}">
    <h2>Feedback for "{{ icon.name }}"</h2>

    <div class="icon-container">
      <!-- Icon Section -->
      <div class="icon-box">
        <figure id="figure-{{ icon.name }}-feedback">
          {{ icon.svg|safe }}
        </figure>
      </div>

      <!-- Properties Section -->
      <div class="properties-box">
        <h3>Property Mapping</h3>
        <pre style="font-size: small; line-height: 1.2; padding: 25px;">{{ icon.properties|tojson(indent=2) }}</pre>
      </div>
    </div>

    <textarea id="feedbackReason-{{ icon.name }}" placeholder="Why does this icon need improvement?" rows="4" required></textarea>
    <menu>
      <button type="submit" onclick="sendFeedback('{{ icon.name }}', 'feedbackReason-{{ icon.name }}')">Submit</button>
      <button type="button" onclick="closeFeedbackDialog('feedbackDialog-{{ icon.name }}')">Cancel</button>
    </menu>
  </form>
</dialog>

<div class="icon-container">
  <!-- Icon Section -->
  <div class="icon-box">
    <figure id="figure-{{ icon.name }}">
      {{ icon.svg|safe }}
    </figure>
  </div>

  <!-- Properties Section -->
  <div class="properties-box">
    <h3>Property Mapping</h3>
    <pre style="font-size: small; line-height: 1.2; padding: 25px;">{{ icon.properties|tojson(indent=2) }}</pre>
  </div>
</div>
<hr>
{% endfor %}

<!-- JavaScript for Download Functionality -->
<script>
function openFeedbackDialog(dialogId) {
  const feedbackDialog = document.getElementById(dialogId);
  if (feedbackDialog) feedbackDialog.showModal();
}

function closeFeedbackDialog(dialogId) {
  const feedbackDialog = document.getElementById(dialogId);
  if (feedbackDialog) feedbackDialog.close();
}

async function sendFeedback(iconName, reasonId) {
  const feedbackReason = document.getElementById(reasonId).value;
  if (!feedbackReason.trim()) {
    alert('Please provide a reason for your feedback.');
    return;
  }

  const webhookUrl = '<DISCORD_WEBHOOK_URL>';
  try {
    await fetch(webhookUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        content: `**Icon Name:** ${iconName}\n**Feedback:** ${feedbackReason}`
      })
    });
    alert('Feedback sent! Thank you.');
    closeFeedbackDialog(`feedbackDialog-${iconName}`);
  } catch (error) {
    console.error('Error sending feedback:', error);
    alert('An error occurred while sending feedback. Please try again later.');
  }
}
</script>
